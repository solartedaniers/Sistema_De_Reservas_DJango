{% extends "base.html" %}
{% block title %}Calendario de Reservas{% endblock %}
{% block content %}
<h2 class="mb-4">Calendario de Reservas</h2>
<div id="calendar"></div>

<!-- FullCalendar CSS y JS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales-all.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');

    // Carga de eventos desde Django
    const eventos = JSON.parse('{{ reservas_json|escapejs }}');

    // Verifica si el usuario es administrador
    const isAdmin = "{{ is_admin|yesno:'true,false' }}" === "true";

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'es',
        events: eventos,
        height: 600,
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,listWeek'
        },
        eventClick: function(info) {
            if (isAdmin) {
                alert(info.event.title + '\n' + info.event.start.toLocaleDateString());
            } else {
                alert('Este día ya está reservado.');
            }
        }
    });

    calendar.render();
});
</script>
{% endblock %}